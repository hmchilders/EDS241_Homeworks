<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Heather Childers">

<title>Homework 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="HW2_files/libs/clipboard/clipboard.min.js"></script>
<script src="HW2_files/libs/quarto-html/quarto.js"></script>
<script src="HW2_files/libs/quarto-html/popper.min.js"></script>
<script src="HW2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="HW2_files/libs/quarto-html/anchor.min.js"></script>
<link href="HW2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="HW2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="HW2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="HW2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="HW2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Homework 2</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Heather Childers </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="eds-241-homework-2" class="level1">
<h1>EDS 241: Homework 2</h1>
<p><strong>Reminders:</strong> Make sure to read through the setup in markdown. Remember to fully report/interpret your results and estimates (in writing) + present them in tables/plots.</p>
</section>
<section id="part-1-treatment-ignorability-assumption-and-applying-matching-estimators-19-points" class="level1">
<h1>Part 1 Treatment Ignorability Assumption and Applying Matching Estimators (19 points):</h1>
<p>The goal is to estimate the causal effect of maternal smoking during pregnancy on infant birth weight using the treatment ignorability assumptions. The data are taken from the National Natality Detail Files, and the extract “SMOKING_EDS241.csv”’ is a random sample of all births in Pennsylvania during 1989-1991. Each observation is a mother-infant pair. The key variables are:</p>
<p><strong>The outcome and treatment variables are:</strong></p>
<p>birthwgt=birth weight of infant in grams</p>
<p>tobacco=indicator for maternal smoking</p>
<p><strong>The control variables are:</strong></p>
<p>mage (mother’s age), meduc (mother’s education), mblack (=1 if mother identifies as Black), alcohol (=1 if consumed alcohol during pregnancy), first (=1 if first child), diabete (=1 if mother diabetic), anemia (=1 if mother anemic)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data for Part 1</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"Homework2"</span>, <span class="st">"data"</span>, <span class="st">"SMOKING_EDS241.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="mean-differences-assumptions-and-covariates-3-pts-question-a" class="level2">
<h2 class="anchored" data-anchor-id="mean-differences-assumptions-and-covariates-3-pts-question-a">Mean Differences, Assumptions, and Covariates <em>(3 pts) [Question A]</em></h2>
<ol type="a">
<li><p><strong>What is the mean difference in birth weight of infants with smoking and non-smoking mothers [1 pts]?</strong></p>
<p>There is approximately a 245gram difference in the mean birth weights between non smoking and smoking mothers. The mean birthweight from non-smoking mothers is roughly 3430 grams and the mean birthweight from smoking mothers was roughly 3186grams. There is a significant difference between the mean birthweights with a p-value less than 0.001.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>smoking <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tobacco <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>nonsmoking <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tobacco <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(smoking<span class="sc">$</span>birthwgt, nonsmoking<span class="sc">$</span>birthwgt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  smoking$birthwgt and nonsmoking$birthwgt
t = -58.932, df = 26945, p-value &lt; 0.00000000000000022
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -252.6727 -236.4060
sample estimates:
mean of x mean of y 
 3185.747  3430.286 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(nonsmoking<span class="sc">$</span>birthwgt)<span class="sc">-</span><span class="fu">mean</span>(smoking<span class="sc">$</span>birthwgt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 244.5394</code></pre>
</div>
</div>
<ol start="2" type="a">
<li><p><strong>Under what assumption does this correspond to the average treatment effect of maternal smoking during pregnancy on infant birth weight [0.5 pts]?</strong></p>
<p>The difference in means could be used as a measure for the ATE of maternal smoking on birthweights if there is no correlation between the treatment D and the unobservable characteristics u. However, observational studies are typically prone to biased treatment effect estimates.</p></li>
<li><p><strong>Calculate and create a table demonstrating the differences in the mean proportions/values of covariates observed in smokers and non-smokers (remember to report whether differences are statistically significant) and discuss whether this provides empirical evidence for or against this assumption. Remember that this is observational data. What other quantitative empirical evidence or test could help you assess the former assumption? [1.5 pts: 0.5 pts table, 1 pts discussion]</strong></p>
<p>Each of the covariates that we observed in this sample had significant differences in the means, except for diabetes. The anemia characteristic had a control value of 0.014 and a treatment value of 0.007 with a p-value less than 0.001, which implies a significant difference in th mean values between the treated and non-treated groups. The alcohol characteristic had a control value of 0.044 and a treatment value of 0.007 with a p-value less than 0.001, which implies a significant difference in th mean values between the treated and non-treated groups. The mblack characteristic had a control value of 0.135 and a treatment value of 0.108 with a p-value less than 0.001, which implies a significant difference in th mean values between the treated and non-treated groups. The first characteristic had a control value of 0.364 and a treatment value of 0.436 with a p-value less than 0.001, which implies a significant difference in th mean values between the treated and non-treated groups. The mage characteristic had a control value of 27.45 and a treatment value of 25.53 with a p-value less than 0.001, which implies a significant difference in th mean values between the treated and non-treated groups. The meduc characteristic had a control value of 13.24 and a treatment value of 11.92 with a p-value less than 0.001, which implies a significant difference in the mean values between the treated and non-treated groups. The only non-significant difference in means was for the diabete characteristic with a control value of 0.0175 and a treatment value of 0.0173, with a p-value of 0.885 which implies there is no significant difference between the means. These results provide empirical evidence that the characteristics from the treatment and control groups are significantly different and therefore violate the assumption from section b. We could use matching and propensity scoring to help create a less biased counterfactual.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecting binary and continuous variables from the dataset</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>pretreat_binary <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(anemia, diabete, alcohol, mblack, first, tobacco)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>pretreat_continuous <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(tobacco, mage, meduc, birthwgt)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>control_binary <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(anemia, diabete, alcohol, mblack, first)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>control_continuous <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(mage, meduc)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize empty data frames to store results of tests</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>prop_test_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>t_test_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifying binary variables for proportion tests</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>binary_vars <span class="ot">&lt;-</span> <span class="fu">names</span>(control_binary)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var <span class="cf">in</span> binary_vars) {</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting the data into treated and untreated groups for the current variable</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>treated <span class="ot">&lt;-</span> pretreat_binary <span class="sc">%&gt;%</span> <span class="fu">filter</span>(tobacco <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="sc">!!</span><span class="fu">sym</span>(var))</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>untreated <span class="ot">&lt;-</span> pretreat_binary <span class="sc">%&gt;%</span> <span class="fu">filter</span>(tobacco <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="sc">!!</span><span class="fu">sym</span>(var))</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Performing the proportion test</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>prop_test_result <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fu">sum</span>(treated), <span class="fu">sum</span>(untreated)),</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="at">n =</span> <span class="fu">c</span>(<span class="fu">length</span>(treated), <span class="fu">length</span>(untreated)),</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="at">correct =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Storing the tidy results of the proportion test in the data frame</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>prop_test_result_tidy <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">tidy</span>(prop_test_result)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>prop_test_result_tidy<span class="sc">$</span>Variable <span class="ot">&lt;-</span> var</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>prop_test_results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(prop_test_results, prop_test_result_tidy)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifying continuous variables for t-tests</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>continuous_vars <span class="ot">&lt;-</span> <span class="fu">names</span>(control_continuous)</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var <span class="cf">in</span> continuous_vars) {</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Dynamically creating the formula for the t-test</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(var, <span class="st">"~ tobacco"</span>))</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Performing the t-test</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>t_test_result <span class="ot">&lt;-</span> <span class="fu">t.test</span>(formula, <span class="at">data =</span> pretreat_continuous)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Storing the tidy results of the t-test in the data frame</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>t_test_result_tidy <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">tidy</span>(t_test_result)</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>t_test_result_tidy<span class="sc">$</span>Variable <span class="ot">&lt;-</span> var</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>t_test_results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(t_test_results, t_test_result_tidy)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Combining the results of proportion and t-tests into a single data frame</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>combined_results <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>prop_test_results <span class="sc">%&gt;%</span> <span class="fu">select</span>(Variable, estimate1, estimate2, p.value),</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>t_test_results <span class="sc">%&gt;%</span> <span class="fu">select</span>(Variable, estimate1, estimate2, p.value)</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a table for output using kable and kableExtra</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>combined_results_table <span class="ot">&lt;-</span> <span class="fu">kable</span>(combined_results, <span class="at">format =</span> <span class="st">"latex"</span>,</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>                                <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Variable"</span>,</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Proportion or Mean Control"</span>,</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"Proportion or Mean Treated"</span>, <span class="st">"P-Value"</span>),</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>                                <span class="at">caption =</span> <span class="st">"Treated and Untreated Pre-treatment Proportion and T-Test Results"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">7</span>, <span class="at">latex_options =</span> <span class="st">"hold_position"</span>)</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Displaying the table</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>combined_results_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

</div>
</div>
</section>
<section id="ate-and-covariate-balance-3-pts-question-b" class="level2">
<h2 class="anchored" data-anchor-id="ate-and-covariate-balance-3-pts-question-b">ATE and Covariate Balance <em>(3 pts) [Question B]</em></h2>
<ol start="2" type="a">
<li><strong>Assume that maternal smoking is randomly assigned conditional on the observable covariates listed above. Estimate the effect of maternal smoking on birth weight using an OLS regression with NO linear controls for the covariates [0.5 pts].</strong></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ATE Regression univariate</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>regression_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(birthwgt <span class="sc">~</span> tobacco, <span class="at">data =</span> data)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(regression_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = birthwgt ~ tobacco, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-1930.29  -295.75    28.71   340.71  1314.25 

Coefficients:
            Estimate Std. Error t value            Pr(&gt;|t|)    
(Intercept) 3430.286      1.791 1915.52 &lt;0.0000000000000002 ***
tobacco     -244.539      4.079  -59.95 &lt;0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 493.8 on 94171 degrees of freedom
Multiple R-squared:  0.03676,   Adjusted R-squared:  0.03675 
F-statistic:  3594 on 1 and 94171 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<ol start="2" type="a">
<li><strong>Perform the same estimate including the control variables [0.5 pts].</strong></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ATE with covariates</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>regression_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(birthwgt <span class="sc">~</span> tobacco <span class="sc">+</span> anemia<span class="sc">+</span> diabete <span class="sc">+</span> alcohol <span class="sc">+</span> mblack <span class="sc">+</span> first <span class="sc">+</span> mage <span class="sc">+</span> meduc, <span class="at">data =</span> data)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(regression_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = birthwgt ~ tobacco + anemia + diabete + alcohol + 
    mblack + first + mage + meduc, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-2024.45  -294.06    20.61   329.63  1502.19 

Coefficients:
             Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept) 3362.2582    11.9273 281.897 &lt; 0.0000000000000002 ***
tobacco     -228.0731     4.1775 -54.596 &lt; 0.0000000000000002 ***
anemia        -4.7964    16.7544  -0.286               0.7747    
diabete       73.2275    12.1035   6.050        0.00000000145 ***
alcohol      -77.3497    13.4654  -5.744        0.00000000926 ***
mblack      -240.0303     5.1062 -47.007 &lt; 0.0000000000000002 ***
first        -96.9441     3.4466 -28.127 &lt; 0.0000000000000002 ***
mage          -0.6940     0.3566  -1.946               0.0516 .  
meduc         11.6883     0.8605  13.583 &lt; 0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 484.7 on 94164 degrees of freedom
Multiple R-squared:  0.0717,    Adjusted R-squared:  0.07162 
F-statistic: 909.2 on 8 and 94164 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<ol start="2" type="a">
<li><strong>Next, compute indices of covariate imbalance between the treated and non-treated regarding these covariates (see example file from class). Present your results in a table [1 pts].</strong></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Covariate imbalance</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>cov_imbal <span class="ot">&lt;-</span> <span class="fu">xBalance</span>(tobacco <span class="sc">~</span>  anemia<span class="sc">+</span> diabete <span class="sc">+</span> alcohol <span class="sc">+</span> mblack <span class="sc">+</span> first <span class="sc">+</span> mage <span class="sc">+</span> meduc, <span class="at">data =</span> data, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">report=</span><span class="fu">c</span>(<span class="st">"std.diffs"</span>,<span class="st">"chisquare.test"</span>, <span class="st">"p.values"</span>))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Balance Table </span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(cov_imbal, <span class="at">format =</span> <span class="st">"latex"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                                <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"std.diffs"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"chisquare.test"</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"p.values"</span>),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                                <span class="at">caption =</span> <span class="st">"indices of covariate imbalance between the treated and non-treated"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

</div>
</div>
<ol start="2" type="a">
<li><strong>What do you find and what does it say regarding whether the assumption you mentioned responding to a) is fulfilled? [1 pts]</strong></li>
</ol>
</section>
<section id="propensity-score-estimation-3-pts-question-c" class="level2">
<h2 class="anchored" data-anchor-id="propensity-score-estimation-3-pts-question-c">Propensity Score Estimation <em>(3 pts) [Question C]</em></h2>
<ol start="5" type="a">
<li><strong>Next, estimate propensity scores (i.e.&nbsp;probability of being treated) for the sample, using the provided covariates. Create a regression table reporting the results of the regression and discuss what the covariate coefficients indicate and interpret one coefficient [1.5 pts]. (believe that we are finding valid counterfacuals)</strong></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Propensity Scores</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>ps <span class="ot">&lt;-</span> <span class="fu">glm</span>(tobacco <span class="sc">~</span> anemia<span class="sc">+</span> diabete <span class="sc">+</span> alcohol <span class="sc">+</span> mblack <span class="sc">+</span> first <span class="sc">+</span> mage <span class="sc">+</span> meduc,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> data, <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = tobacco ~ anemia + diabete + alcohol + mblack + 
    first + mage + meduc, family = binomial(), data = data)

Coefficients:
             Estimate Std. Error z value             Pr(&gt;|z|)    
(Intercept)  3.493297   0.066613  52.442 &lt; 0.0000000000000002 ***
anemia       0.333952   0.079367   4.208          0.000025797 ***
diabete      0.159533   0.065861   2.422               0.0154 *  
alcohol      2.026641   0.060353  33.580 &lt; 0.0000000000000002 ***
mblack      -0.133447   0.026587  -5.019          0.000000519 ***
first       -0.379167   0.019303 -19.643 &lt; 0.0000000000000002 ***
mage        -0.040562   0.001931 -21.007 &lt; 0.0000000000000002 ***
meduc       -0.297269   0.005152 -57.699 &lt; 0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 92325  on 94172  degrees of freedom
Residual deviance: 84459  on 94165  degrees of freedom
AIC: 84475

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>psvalue <span class="ot">&lt;-</span> <span class="fu">predict</span>(ps, <span class="at">type    =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="5" type="a">
<li><strong>Create histograms of the propensity scores comparing the distributions of propensity scores for smokers (‘treated’) and non-smokers (‘control’), discuss the overlap and what it means [1.5 pts].</strong></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## PS Histogram Unmatched </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">histbackback</span>(<span class="fu">split</span>(data<span class="sc">$</span>psvalue, data<span class="sc">$</span>tobacco), <span class="at">main=</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Propensity score before matching"</span>, <span class="at">xlab=</span><span class="fu">c</span>(<span class="st">"non-smokers"</span>, <span class="st">"smokers"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="HW2_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="384"></p>
</div>
</div>
</section>
<section id="matching-balance-3-pts-question-d" class="level2">
<h2 class="anchored" data-anchor-id="matching-balance-3-pts-question-d">Matching Balance <em>(3 pts) [Question D]</em></h2>
<ol start="4" type="a">
<li>Next, match treated/control mothers using your estimated propensity scores and nearest neighbor matching. Compare the balancing of pre-treatment characteristics (covariates) between treated and non-treated units in the original dataset (from c) with the matched dataset (think about comparing histograms/regressions) [2 pts].</li>
<li>Make sure to report and discuss the balance statistics [1 pts].</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Nearest-neighbor Matching</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>m.nn    <span class="ot">&lt;-</span> <span class="fu">matchit</span>(tobacco <span class="sc">~</span> anemia <span class="sc">+</span> diabete <span class="sc">+</span> alcohol <span class="sc">+</span> mblack <span class="sc">+</span> first <span class="sc">+</span> mage <span class="sc">+</span> meduc,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">"nearest"</span>, <span class="at">ratio =</span> <span class="dv">1</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m.nn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
matchit(formula = tobacco ~ anemia + diabete + alcohol + mblack + 
    first + mage + meduc, data = data, method = "nearest", ratio = 1)

Summary of Balance for All Data:
         Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean
distance        0.2600        0.1767          0.6190     1.6361    0.1402
anemia          0.0141        0.0078          0.0535          .    0.0063
diabete         0.0175        0.0174          0.0012          .    0.0002
alcohol         0.0442        0.0071          0.1804          .    0.0371
mblack          0.1354        0.1086          0.0783          .    0.0268
first           0.3646        0.4361         -0.1486          .    0.0715
mage           25.5386       27.4531         -0.3663     0.9709    0.0766
meduc          11.9209       13.2394         -0.8190     0.5662    0.0734
         eCDF Max
distance   0.2945
anemia     0.0063
diabete    0.0002
alcohol    0.0371
mblack     0.0268
first      0.0715
mage       0.1676
meduc      0.2773

Summary of Balance for Matched Data:
         Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean
distance        0.2600        0.2560          0.0299     1.2066    0.0024
anemia          0.0141        0.0134          0.0061          .    0.0007
diabete         0.0175        0.0172          0.0021          .    0.0003
alcohol         0.0442        0.0240          0.0984          .    0.0202
mblack          0.1354        0.1319          0.0103          .    0.0035
first           0.3646        0.3641          0.0009          .    0.0004
mage           25.5386       25.4882          0.0096     1.0004    0.0021
meduc          11.9209       11.8534          0.0420     0.8306    0.0051
         eCDF Max Std. Pair Dist.
distance   0.0218          0.0300
anemia     0.0007          0.1070
diabete    0.0003          0.0718
alcohol    0.0202          0.1670
mblack     0.0035          0.0982
first      0.0004          0.0989
mage       0.0071          0.1030
meduc      0.0256          0.1443

Sample Sizes:
          Control Treated
All         76021   18152
Matched     18152   18152
Unmatched   57869       0
Discarded       0       0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>match.data <span class="ot">=</span> <span class="fu">match.data</span>(m.nn)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Covariate Imbalance post matching: </span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">xBalance</span>(tobacco <span class="sc">~</span>  anemia<span class="sc">+</span> diabete <span class="sc">+</span> alcohol <span class="sc">+</span> mblack <span class="sc">+</span> first <span class="sc">+</span> mage <span class="sc">+</span> meduc, <span class="at">data =</span> match.data, </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">report=</span><span class="fu">c</span>(<span class="st">"std.diffs"</span>,<span class="st">"chisquare.test"</span>, <span class="st">"p.values"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        strata():  unstrat     
        stat      std.diff     
vars                           
anemia                0.01     
diabete               0.00     
alcohol               0.11 *** 
mblack                0.01     
first                 0.00     
mage                  0.01     
meduc                 0.04 *** 
---Overall Test---
        chisquare df                      p.value
unstrat       124  7 0.00000000000000000000000999
---
Signif. codes:  0 '***' 0.001 '** ' 0.01 '*  ' 0.05 '.  ' 0.1 '   ' 1 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Histogram of PS after matching</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">histbackback</span>(<span class="fu">split</span>(match.data<span class="sc">$</span>psvalue, match.data<span class="sc">$</span>tobacco), <span class="at">main=</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Propensity score after matching"</span>, <span class="at">xlab=</span><span class="fu">c</span>(<span class="st">"non-smokers"</span>, <span class="st">"smokers"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="HW2_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="384"></p>
</div>
</div>
</section>
<section id="att-with-nearest-neighbor-3-pts-question-e" class="level2">
<h2 class="anchored" data-anchor-id="att-with-nearest-neighbor-3-pts-question-e">ATT with Nearest Neighbor <em>(3 pts) [Question E]</em></h2>
<ol start="5" type="a">
<li>Estimate the ATT using the matched dataset. <strong>Report and interpret your result</strong> (Note: no standard error or significance test is required here)</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Nearest Neighbor </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>sumdiff_data<span class="ot">&lt;-</span>match.data<span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(subclass)<span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff=</span>birthwgt[tobacco<span class="sc">==</span><span class="dv">1</span>]<span class="sc">-</span>birthwgt[tobacco<span class="sc">==</span><span class="dv">0</span>])</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="do">## ATT</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>NT <span class="ot">=</span> <span class="fu">sum</span>(smoking<span class="sc">$</span>tobacco)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>sumdiff<span class="ot">&lt;-</span><span class="fu">sum</span>(sumdiff_data<span class="sc">$</span>diff)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>ATT_m_nn <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>NT <span class="sc">*</span> sumdiff</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>ATT_m_nn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -222.9365</code></pre>
</div>
</div>
</section>
<section id="ate-with-wls-matching-3-pts-question-f" class="level2">
<h2 class="anchored" data-anchor-id="ate-with-wls-matching-3-pts-question-f">ATE with WLS Matching <em>(3 pts) [Question F]</em></h2>
<ol start="6" type="a">
<li>Last, use the original dataset and perform the weighted least squares estimation of the ATE using the propensity scores (including controls). Report and interpret your results, here include both size and precision of estimate in reporting and interpretation.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Weighted least Squares (WLS) estimator Preparation</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>PS <span class="ot">&lt;-</span> data<span class="sc">$</span>psvalue</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> data<span class="sc">$</span>birthwgt</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> data<span class="sc">$</span>tobacco</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>EY1 <span class="ot">&lt;-</span> D<span class="sc">*</span>Y<span class="sc">/</span>PS <span class="sc">/</span> <span class="fu">sum</span>(D<span class="sc">/</span>PS)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>EY0 <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>D)<span class="sc">*</span>Y<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>PS) <span class="sc">/</span> <span class="fu">sum</span>((<span class="dv">1</span><span class="sc">-</span>D) <span class="sc">/</span> (<span class="dv">1</span><span class="sc">-</span>PS))</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>ATE_IPW <span class="ot">=</span> <span class="fu">sum</span>(EY1) <span class="sc">-</span> <span class="fu">sum</span>(EY0)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>ATE_IPW</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -231.3871</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>wgt <span class="ot">=</span> (D<span class="sc">/</span>PS <span class="sc">+</span> (<span class="dv">1</span><span class="sc">-</span>D)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>PS))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Weighted least Squares (WLS) Estimates</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>reg_wls <span class="ot">&lt;-</span><span class="fu">lm</span>(tobacco <span class="sc">~</span>  anemia<span class="sc">+</span> diabete <span class="sc">+</span> alcohol <span class="sc">+</span> mblack <span class="sc">+</span> first <span class="sc">+</span> mage <span class="sc">+</span> meduc,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> data, <span class="at">weights =</span> wgt)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Present Results</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(reg_wls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = tobacco ~ anemia + diabete + alcohol + mblack + 
    first + mage + meduc, data = data, weights = wgt)

Weighted Residuals:
    Min      1Q  Median      3Q     Max 
-2.8238 -0.5604 -0.5263 -0.4662  3.0398 

Coefficients:
              Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)  0.5507999  0.0114935  47.923 &lt; 0.0000000000000002 ***
anemia       0.0049728  0.0168933   0.294                0.768    
diabete      0.0120639  0.0122651   0.984                0.325    
alcohol     -0.0003071  0.0138603  -0.022                0.982    
mblack       0.0400886  0.0050326   7.966 0.000000000000001660 ***
first        0.0204892  0.0035253   5.812 0.000000006188537536 ***
mage         0.0029144  0.0003580   8.140 0.000000000000000401 ***
meduc       -0.0117661  0.0008792 -13.382 &lt; 0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.7019 on 94165 degrees of freedom
Multiple R-squared:  0.002676,  Adjusted R-squared:  0.002601 
F-statistic: 36.09 on 7 and 94165 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
</section>
<section id="differences-in-estimates-1-pts" class="level2">
<h2 class="anchored" data-anchor-id="differences-in-estimates-1-pts">Differences in Estimates <em>(1 pts)</em></h2>
<ol start="7" type="a">
<li>Explain why it was to be expected given your analysis above that there is a difference between your estimates in e) and f)?</li>
</ol>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="part-2-panel-model-and-fixed-effects-6-points" class="level1">
<h1>Part 2 Panel model and fixed effects (6 points)</h1>
<p>We will use the progresa data from last time as well as a new dataset. In the original dataset, treatment households had been receiving the transfer for a year. Now, you get an additional dataset with information on the same households from before the program was implemented, establishing a baseline study (from 1997), and the same data we worked with last time (from 1999). *Note: You will need to install the packages plm and dplyr (included in template preamble). Again, you can find a description of the variables at the bottom of PDF and HERE.</p>
<section id="estimating-effect-with-first-difference-3-pts-1.5-pts-estimate-1.5-pts-interpretation" class="level2">
<h2 class="anchored" data-anchor-id="estimating-effect-with-first-difference-3-pts-1.5-pts-estimate-1.5-pts-interpretation">Estimating Effect with First Difference <em>(3 pts: 1.5 pts estimate, 1.5 pts interpretation)</em></h2>
<p>Setup: Load the new baseline data (progresa_pre_1997.csv) and the follow-up data (progresa_post_1999.csv) into R. Note that we created a time denoting variable (with the same name, ‘year’) in BOTH datasets. Then, create a panel dataset by appending the data (i.e.&nbsp;binding the dataset row-wise together creating a single dataset). We want to examine the same outcome variable as before, value of animal holdings (vani).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>()) <span class="co"># clean environment</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Load the datasets</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>progresa_pre_1997 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"Homework2"</span>, <span class="st">"data"</span>,<span class="st">"progresa_pre_1997.csv"</span>)) </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>progresa_post_1999 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"Homework2"</span>,<span class="st">"data"</span>,<span class="st">"progresa_post_1999.csv"</span>))</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Append post to pre dataset </span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>progresa <span class="ot">&lt;-</span> <span class="fu">rbind</span>(progresa_pre_1997, progresa_post_1999)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="a">
<li>Estimate a first-difference (FD) regression manually, interpret the results briefly (size of coefficient and precision!) *Note: Calculate the difference between pre- and post- program outcomes for each family. To do that, follow these steps and the code given in the R-template:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Code included to help get you started</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="do">## i. Sort the panel data in the order in which you want to take differences, i.e. by household and time.</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Create first differences of variables</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a> progresa <span class="ot">&lt;-</span> progresa <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(hhid, year) <span class="sc">%&gt;%</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(hhid) <span class="sc">%&gt;%</span> </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">vani_fd =</span> vani <span class="sc">-</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(vani)) </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="do">## ii. Calculate the first difference using the lag function from the dplyr package.</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="do">## iii. Estimate manual first-difference regression (Estimate the regression using the newly created variables.)</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>fd_manual <span class="ot">&lt;-</span> <span class="fu">lm</span>(vani_fd <span class="sc">~</span> treatment, <span class="at">data =</span> progresa)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fd_manual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = vani_fd ~ treatment, data = progresa)

Residuals:
   Min     1Q Median     3Q    Max 
-80706   -129    837   1207  46073 

Coefficients:
            Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept) -1156.75      64.49 -17.936 &lt; 0.0000000000000002 ***
treatment     287.90      85.60   3.363             0.000772 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4930 on 13512 degrees of freedom
  (17143 observations deleted due to missingness)
Multiple R-squared:  0.0008365, Adjusted R-squared:  0.0007625 
F-statistic: 11.31 on 1 and 13512 DF,  p-value: 0.0007723</code></pre>
</div>
</div>
</section>
<section id="fixed-effects-estimates-2-pts-1-pts-estimate-1.5-interpretation" class="level2">
<h2 class="anchored" data-anchor-id="fixed-effects-estimates-2-pts-1-pts-estimate-1.5-interpretation">Fixed Effects Estimates <em>(2 pts: 1 pts estimate, 1.5 interpretation)</em></h2>
<ol start="2" type="a">
<li>Now also run a fixed effects (FE or ‘within’) regression and compare the results. Interpret the estimated treatment effects briefly (size of coefficient and precision!)</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Fixed Effects Regression</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Present Regression Results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="first-difference-and-fixed-effects-and-omitted-variable-problems-1-pts" class="level2">
<h2 class="anchored" data-anchor-id="first-difference-and-fixed-effects-and-omitted-variable-problems-1-pts">First Difference and Fixed Effects and Omitted Variable Problems <em>(1 pts)</em></h2>
<ol start="3" type="a">
<li>Explain briefly how the FD and FE estimator solves a specific omitted variable problem? Look at the example on beer tax and traffic fatalities from class to start thinking about ommitted variables. Give an example of a potential omitted variable for the example we are working with here that might confound our results? For that omitted variable, is a FE or FD estimator better? One example is enough.</li>
</ol>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>